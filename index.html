<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gmail Marko - Advanced Pro</title>
    
    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #1a73e8;
            --secondary: #34a853;
            --danger: #d93025;
            --warning: #f9ab00;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-dark: #202124;
            --text-light: #5f6368;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; }
        body { background-color: var(--bg); color: var(--text-dark); }
        
        .app-container { max-width: 480px; margin: 0 auto; background: var(--card-bg); min-height: 100vh; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.05); }

        /* Auth Styles */
        .auth-screen { padding: 50px 25px; text-align: center; }
        .logo { font-size: 32px; font-weight: 800; color: var(--danger); margin-bottom: 30px; letter-spacing: -1px; }
        input { 
            width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 10px; outline: none; margin-bottom: 12px; font-size: 15px; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); box-shadow: 0 0 5px rgba(26,115,232,0.2); }
        .btn { 
            width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 10px; 
            font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.3s;
        }
        .btn:active { transform: scale(0.98); }
        .hidden { display: none !important; }

        /* Header & Dashboard */
        header { background: linear-gradient(135deg, #1a73e8, #0d47a1); color: white; padding: 30px 20px; border-radius: 0 0 25px 25px; }
        
        .balance-card { 
            background: white; color: var(--text-dark); padding: 30px 20px; border-radius: 18px; 
            margin-top: 20px; box-shadow: 0 8px 15px rgba(0,0,0,0.1); text-align: center;
        }

        /* Sections */
        .content-section { padding: 25px 20px 100px 20px; }
        .section-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }

        /* Table Style */
        .data-card { background: #fff; border: 1px solid #eee; border-radius: 12px; overflow: hidden; margin-top: 10px; }
        .input-table { width: 100%; border-collapse: collapse; }
        .input-table th { background: #f1f3f4; padding: 12px; font-size: 13px; text-align: left; color: var(--text-light); }
        .input-table td { padding: 10px; border-top: 1px solid #eee; font-size: 14px; }
        .input-table input { margin-bottom: 0; padding: 8px; border: none; background: #f9f9f9; }

        /* Badges */
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; }
        .pending { background: #fff4e5; color: #b06000; }
        .approve { background: #e6f4ea; color: #137333; }
        .reject { background: #fce8e6; color: #c5221f; }

        /* Nav */
        .bottom-nav { 
            position: fixed; bottom: 0; width: 100%; max-width: 480px; background: white; 
            display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #eee; 
            box-shadow: 0 -5px 15px rgba(0,0,0,0.05); z-index: 100;
        }
        .nav-item { text-align: center; font-size: 11px; color: #888; cursor: pointer; flex: 1; transition: 0.3s; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }
        .nav-item.active { color: var(--primary); font-weight: bold; }

        /* UI Helpers */
        .refer-box { 
            background: #e8f0fe; padding: 15px; border-radius: 12px; text-align: center; 
            margin-top: 20px; border: 1px dashed var(--primary);
        }
        .copy-btn { color: var(--primary); cursor: pointer; font-weight: bold; margin-left: 5px; }
    </style>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<div class="app-container">
    
    <!-- AUTH SCREEN -->
    <div id="auth-screen" class="auth-screen">
        <div class="logo">Gmail Marko</div>
        
        <div id="login-form">
            <h2 style="margin-bottom: 20px;">Welcome Back</h2>
            <input type="email" id="login-email" placeholder="Email Address">
            <input type="password" id="login-pass" placeholder="Password">
            <button class="btn" onclick="loginUser()">Login Account</button>
            <p style="margin-top:20px; color: var(--text-light);" onclick="toggleAuth()">New member? <span style="color:var(--primary); font-weight:bold; cursor:pointer;">Create Account</span></p>
        </div>

        <div id="register-form" class="hidden">
            <h2 style="margin-bottom: 20px;">Register</h2>
            <input type="text" id="reg-name" placeholder="Your Full Name">
            <input type="email" id="reg-email" placeholder="Email Address">
            <input type="password" id="reg-pass" placeholder="Create Password">
            <input type="text" id="reg-refer" placeholder="Refer Code (Optional)">
            <button class="btn" style="background: var(--secondary);" onclick="registerUser()">Register Now</button>
            <p style="margin-top:20px; color: var(--text-light);" onclick="toggleAuth()">Already have account? <span style="color:var(--primary); font-weight:bold; cursor:pointer;">Login</span></p>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="main-app" class="hidden">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <p style="font-size: 14px; opacity: 0.9;">Hello, <b id="user-display-name">...</b> ðŸ‘‹</p>
                    <small onclick="copyID()" style="cursor:pointer; opacity: 0.7;">ID: <span id="display-user-id">...</span> <i class="fa-regular fa-copy"></i></small>
                </div>
                <button onclick="logout()" style="background:none; border:none; color:white; font-size: 18px;"><i class="fa-solid fa-right-from-bracket"></i></button>
            </div>

            <div class="balance-card">
                <p style="color: var(--text-light); font-size: 13px; font-weight: 600;">AVAILABLE BALANCE</p>
                <h1 id="user-balance" style="font-size: 36px; color: var(--primary);">0 TK</h1>
            </div>
        </header>

        <!-- Earn Section -->
        <div id="earn-section" class="content-section">
            <div class="section-title"><i class="fa-solid fa-envelope-open-text" style="color:var(--primary)"></i> Submit Work</div>
            <p style="font-size: 12px; color: var(--secondary); margin-bottom: 10px; font-weight: bold;">Current Rate: 10 TK per verified Gmail</p>
            
            <div class="data-card">
                <table class="input-table">
                    <thead>
                        <tr><th>Gmail Address</th><th>Password</th></tr>
                    </thead>
                    <tbody id="input-rows">
                        <tr><td><input type="text" class="g-email" placeholder="example@gmail.com"></td><td><input type="text" class="g-pass" placeholder="pass123"></td></tr>
                        <tr><td><input type="text" class="g-email" placeholder="example@gmail.com"></td><td><input type="text" class="g-pass" placeholder="pass123"></td></tr>
                    </tbody>
                </table>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn" style="background:#eee; color:#333; flex: 1;" onclick="addMoreRows()">+ Add Row</button>
                <button class="btn" style="flex: 2;" onclick="submitGmails()">Submit All Accounts</button>
            </div>
            
            <div class="refer-box">
                <small>Invite friends and earn more!</small><br>
                <span style="font-size: 16px; font-weight: bold;">Refer Code: <span id="my-refer-code" style="color:var(--primary)">------</span></span>
                <span class="copy-btn" onclick="copyReferLink()"><i class="fa-regular fa-copy"></i> Copy</span>
            </div>
        </div>

        <!-- History/Result Section -->
        <div id="result-section" class="content-section hidden">
            <div class="section-title"><i class="fa-solid fa-clock-rotate-left"></i> Submission History</div>
            <div class="data-card">
                <table class="input-table">
                    <thead style="background:#f8f9fa;">
                        <tr><th>Gmail</th><th>Status</th></tr>
                    </thead>
                    <tbody id="history-table-body">
                        <!-- History items -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Transfer Section -->
        <div id="transfer-section" class="content-section hidden">
            <div class="section-title"><i class="fa-solid fa-paper-plane"></i> Transfer Money</div>
            <div style="background:white; padding:20px; border-radius:15px; border:1px solid #eee;">
                <label style="font-size: 12px; font-weight: bold; color: var(--text-light);">RECIPIENT USER ID</label>
                <input type="text" id="transfer-id" placeholder="Paste Receiver ID here">
                
                <label style="font-size: 12px; font-weight: bold; color: var(--text-light);">AMOUNT (TK)</label>
                <input type="number" id="transfer-amount" placeholder="Min 10 TK">
                
                <button class="btn" style="background:var(--warning)" onclick="handleTransfer()">Instant Transfer</button>
            </div>
        </div>

        <!-- Withdraw Section -->
        <div id="withdraw-section" class="content-section hidden">
            <div class="section-title"><i class="fa-solid fa-wallet"></i> Cash Out</div>
            <div style="background:white; padding:20px; border-radius:15px; border:1px solid #eee;">
                <label style="font-size: 12px; font-weight: bold;">SELECT METHOD</label>
                <select id="withdraw-method" style="width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 15px;">
                    <option value="bkash">bKash (Min 200 TK)</option>
                    <option value="inim">Inim Card (Min 50 TK)</option>
                </select>
                
                <label style="font-size: 12px; font-weight: bold;">ACCOUNT NUMBER</label>
                <input type="text" id="withdraw-number" placeholder="017XXXXXXXX / Wallet ID">
                
                <label style="font-size: 12px; font-weight: bold;">AMOUNT (TK)</label>
                <input type="number" id="withdraw-amount" placeholder="0.00">
                
                <button class="btn" style="background:var(--danger)" onclick="submitWithdraw()">Confirm Withdraw</button>
            </div>
        </div>

        <!-- Bottom Nav -->
        <nav class="bottom-nav">
            <div class="nav-item active" onclick="showSection('earn', this)"><i class="fa-solid fa-house"></i>Earn</div>
            <div class="nav-item" onclick="showSection('transfer', this)"><i class="fa-solid fa-share-nodes"></i>Send</div>
            <div class="nav-item" onclick="showSection('result', this)"><i class="fa-solid fa-list-check"></i>History</div>
            <div class="nav-item" onclick="showSection('withdraw', this)"><i class="fa-solid fa-hand-holding-dollar"></i>Cashout</div>
        </nav>
    </div>
</div>

<script>
    // --- FIREBASE CONFIG ---
    const firebaseConfig = {
        apiKey: "AIzaSyDSA7qbRSc9b08b0hr9SSksts6e8ttC_C0",
        authDomain: "nabadiganta.firebaseapp.com",
        databaseURL: "https://nabadiganta-default-rtdb.firebaseio.com",
        projectId: "nabadiganta",
        storageBucket: "nabadiganta.firebasestorage.app",
        messagingSenderId: "515854427192",
        appId: "1:515854427192:web:711e535ffc44d05746f2cd"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let currentUser = null;
    let currentBalance = 0;

    // --- UI Logic ---
    function toggleAuth() {
        document.getElementById('login-form').classList.toggle('hidden');
        document.getElementById('register-form').classList.toggle('hidden');
    }

    function showSection(id, element) {
        ['earn', 'result', 'withdraw', 'transfer'].forEach(s => document.getElementById(s + '-section').classList.add('hidden'));
        document.getElementById(id + '-section').classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        element.classList.add('active');
    }

    // --- Auth Actions ---
    function registerUser() {
        const name = document.getElementById('reg-name').value;
        const email = document.getElementById('reg-email').value;
        const pass = document.getElementById('reg-pass').value;
        const refer = document.getElementById('reg-refer').value;
        
        if(!name || !email || pass.length < 6) return alert("Fill all fields (Pass: min 6 chars)");

        auth.createUserWithEmailAndPassword(email, pass).then(cred => {
            const myCode = Math.floor(100000 + Math.random() * 900000);
            db.ref('users/' + cred.user.uid).set({
                fullName: name, balance: 0, totalEarned: 0, email: email, referCode: myCode, referredBy: refer || "none", uid: cred.user.uid, joined: new Date().toLocaleDateString()
            });
            alert("Success! Welcome to Gmail Marko.");
        }).catch(err => alert(err.message));
    }

    function loginUser() {
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;
        auth.signInWithEmailAndPassword(email, pass).catch(err => alert(err.message));
    }

    function logout() {
        if(confirm("Logout from app?")) auth.signOut();
    }

    auth.onAuthStateChanged(user => {
        if (user) {
            currentUser = user;
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            loadUserData(user.uid);
        } else {
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }
    });

    // --- Data Management ---
    function loadUserData(uid) {
        document.getElementById('display-user-id').innerText = uid;

        db.ref('users/' + uid).on('value', snap => {
            const data = snap.val();
            if(data){
                currentBalance = data.balance || 0;
                document.getElementById('user-display-name').innerText = data.fullName;
                document.getElementById('user-balance').innerText = currentBalance + " TK";
                document.getElementById('my-refer-code').innerText = data.referCode || "N/A";
            }
        });

        // Load History
        db.ref('submissions/' + uid).on('value', snap => {
            const tbody = document.getElementById('history-table-body');
            tbody.innerHTML = "";
            if(snap.exists()) {
                snap.forEach(child => {
                    const item = child.val();
                    tbody.insertAdjacentHTML('afterbegin', `
                        <tr>
                            <td>${item.email}<br><small style="color:#999">${item.date}</small></td>
                            <td><span class="badge ${item.status}">${item.status}</span></td>
                        </tr>
                    `);
                });
            }
        });
    }

    // --- App Features ---
    function addMoreRows() {
        const tbody = document.getElementById('input-rows');
        for(let i=0; i<3; i++) {
            const tr = document.createElement('tr');
            tr.innerHTML = '<td><input type="text" class="g-email" placeholder="example@gmail.com"></td><td><input type="text" class="g-pass" placeholder="pass123"></td>';
            tbody.appendChild(tr);
        }
    }

    function submitGmails() {
        const emails = document.getElementsByClassName('g-email');
        const passes = document.getElementsByClassName('g-pass');
        let count = 0;

        for (let i = 0; i < emails.length; i++) {
            let e = emails[i].value.trim();
            let p = passes[i].value.trim();
            if (e.includes("@") && p.length > 3) {
                db.ref('submissions/' + currentUser.uid).push({
                    email: e, password: p, status: "pending", date: new Date().toLocaleString()
                });
                emails[i].value = "";
                passes[i].value = "";
                count++;
            }
        }
        if(count > 0) alert("Submitted " + count + " accounts. Verification takes 24h.");
        else alert("Invalid entry! Check Gmail & Password.");
    }

    async function handleTransfer() {
        const receiverId = document.getElementById('transfer-id').value.trim();
        const amount = parseFloat(document.getElementById('transfer-amount').value);

        if(!receiverId || isNaN(amount) || amount < 10) return alert("Minimum transfer 10 TK");
        if(receiverId === currentUser.uid) return alert("Cannot send to yourself");
        if(amount > currentBalance) return alert("Insufficient balance");

        const receiverRef = db.ref('users/' + receiverId);
        const snapshot = await receiverRef.once('value');

        if(snapshot.exists()) {
            const receiverData = snapshot.val();
            await receiverRef.update({ balance: (receiverData.balance || 0) + amount });
            await db.ref('users/' + currentUser.uid).update({ balance: currentBalance - amount });
            db.ref('transfers').push({ from: currentUser.uid, to: receiverId, amount: amount, date: new Date().toLocaleString() });
            alert(`Transfer Successful to ${receiverData.fullName}`);
            document.getElementById('transfer-id').value = "";
            document.getElementById('transfer-amount').value = "";
        } else {
            alert("Receiver ID Not Found!");
        }
    }

    function submitWithdraw() {
        const method = document.getElementById('withdraw-method').value;
        const info = document.getElementById('withdraw-number').value;
        const amount = parseFloat(document.getElementById('withdraw-amount').value);
        let min = (method === 'inim') ? 50 : 200;

        if(!info || isNaN(amount) || amount < min) return alert("Min withdraw for " + method + " is " + min + " TK");
        if(amount > currentBalance) return alert("Insufficient balance");

        db.ref('users/' + currentUser.uid).update({ balance: currentBalance - amount }).then(() => {
            db.ref('withdrawals').push({
                uid: currentUser.uid, method, info, amount, status: "pending", date: new Date().toLocaleString()
            });
            alert("Withdraw request sent! Payment within 12 hours.");
            document.getElementById('withdraw-number').value = "";
            document.getElementById('withdraw-amount').value = "";
        });
    }

    // Utilities
    function copyID() {
        const id = document.getElementById('display-user-id').innerText;
        navigator.clipboard.writeText(id);
        alert("Your User ID Copied!");
    }

    function copyReferLink() {
        const code = document.getElementById('my-refer-code').innerText;
        navigator.clipboard.writeText(code);
        alert("Refer Code Copied!");
    }
</script>

</body>
</html>
